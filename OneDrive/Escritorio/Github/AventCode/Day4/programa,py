import sys
from pathlib import Path

# programa.py
# Lee y muestra el contenido del fichero "ayuda.txt"

def leer_fichero(path: Path) -> str:
    
    try:
        return path.read_text(encoding="utf-8")
    except FileNotFoundError:
        raise SystemExit(f"Error: fichero no encontrado: {path}")
    except UnicodeDecodeError:
        raise SystemExit(f"Error: no se pudo decodificar el fichero: {path}")
    except Exception as e:
        raise SystemExit(f"Error leyendo el fichero: {e}")

def main():
    # ruta por defecto: mismo directorio del script
    ruta = Path(__file__).parent / "ayuda.txt"
    max = 0
    
    indcmax=0
    encontrado = False
    accesible= 0
    # si se pasa un argumento, usarlo como ruta
    if len(sys.argv) > 1:
        ruta = Path(sys.argv[1])
    contenido = leer_fichero(ruta)
    
    # Transformar contenido a una matriz (lista de listas de caracteres)
    matriz = [list(linea) for linea in contenido.splitlines()]
    
    rows = len(matriz)
    cols = len(matriz[0]) if rows > 0 else 0
    accesible = 0
    eliminar=[]
    eliminados=0
    # Recorrer la matriz celda por celda
    while True:
        eliminar=[]
        for i in range(rows):
            for j in range(cols):
                # Solo verificamos si la celda actual es un rollo de papel ('@')
                if matriz[i][j] != '@':
                    continue
                    
                # Contar cuantos vecinos tienen '@'
                count_at = 0
                
                # Coordenadas relativas de los 8 vecinos: NW, N, NE, W, E, SW, S, SE
                vecinos = [
                    (-1, -1), (-1, 0), (-1, 1),
                    (0, -1),           (0, 1),
                    (1, -1),  (1, 0),  (1, 1)
                ]
                
                for di, dj in vecinos:
                    ni, nj = i + di, j + dj
                    
                    # Verificar que el vecino esta dentro de los limites de la matriz
                    if 0 <= ni < rows and 0 <= nj < cols:
                        if matriz[ni][nj] == '@':
                            count_at += 1
                
                # Si hay menos de 4 vecinos con '@', es accesible
                if count_at < 4:
                    eliminar.append((i,j))
        
        if not eliminar:
            break


        for x,y in eliminar:
            matriz[x][y]='.'
            eliminados+=1
    print(eliminados)
                
   
            
            





if __name__ == "__main__":
    main()