import sys
from pathlib import Path

# programa.py
# Lee y muestra el contenido del fichero "ayuda.txt"

def leer_fichero(path: Path) -> str:
    
    try:
        return path.read_text(encoding="utf-8")
    except FileNotFoundError:
        raise SystemExit(f"Error: fichero no encontrado: {path}")
    except UnicodeDecodeError:
        raise SystemExit(f"Error: no se pudo decodificar el fichero: {path}")
    except Exception as e:
        raise SystemExit(f"Error leyendo el fichero: {e}")

def main():
    # ruta por defecto: mismo directorio del script
    ruta = Path(__file__).parent / "ayuda.txt"
    max = 0
    
    indcmax=0
    encontrado = False
    # si se pasa un argumento, usarlo como ruta
    if len(sys.argv) > 1:
        ruta = Path(sys.argv[1])
    contenido = leer_fichero(ruta)
    
    total_joltage = 0
    
    # Iterar linea por linea
    for linea in contenido.splitlines():
        numeros = [int(digito) for digito in linea]
        
        # Necesitamos encontrar exactamente 12 digitos
        needed = 12
        current_pos = 0
        result_digits = []
        N = len(numeros)
        
        while needed > 0:
            # Calculamos hasta donde podemos buscar.
            # Debemos dejar (needed - 1) numeros al final sin tocar.
            # Por ejemplo, si necesitamos 12, debemos dejar 11. El ultimo indice valido es N - 12.
            # En Python el slice final es exclusivo, asi que usamos N - needed + 1
            limit_index = N - needed + 1
            
            # Buscar el maximo en el rango valido [current_pos, limit_index)
            candidates = numeros[current_pos : limit_index]
            
            max_val = -1
            max_rel_index = -1
            
            # Encontrar el valor maximo y su primera aparicion
            for i, val in enumerate(candidates):
                if val > max_val:
                    max_val = val
                    max_rel_index = i
            
            # AÃ±adir el maximo encontrado a nuestro resultado
            result_digits.append(max_val)
            
            # Avanzar la posicion actual justo despues del numero que acabamos de coger
            current_pos += max_rel_index + 1
            needed -= 1
            
        # Convertir la lista de digitos a un numero entero
        line_val = int("".join(map(str, result_digits)))
        print(f"Linea procesada. Max Joltage: {line_val}")
        
        total_joltage += line_val
        
    print(f"Total Output Joltage: {total_joltage}")
            
            





if __name__ == "__main__":
    main()